<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ìš°ë¦¬ ê°€ì¡± 2025 ëª©í‘œ</title>
    
    <meta property="og:title" content="2025 ìš°ë¦¬ ê°€ì¡± ë¯¿ìŒì˜ ê²½ì£¼ ğŸƒâ€â™‚ï¸">
    <meta property="og:description" content="ë§ì”€, ê²°ë‹¨, ê·¸ë¦¬ê³  ì‚¬ë‘ìœ¼ë¡œ í•˜ë‚˜ë˜ëŠ” ê³µê°„">
    <meta property="og:image" content="https://emojigraph.org/media/apple/church_26ea.png">

    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --primary: #4f46e5; --primary-light: #818cf8; --primary-soft: #e0e7ff;
            --bg-color: #f8fafc; --text-main: #1e293b; --text-light: #64748b;
            --accent: #f43f5e; --success: #10b981; --gold: #f59e0b;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1);
            --radius-pill: 50px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { margin: 0; padding: 0; font-family: 'Noto Sans KR', sans-serif; background-color: var(--bg-color); color: var(--text-main); height: 100vh; overflow: hidden; }
        .hidden { display: none !important; } .hidden-view { display: none !important; }

        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

        /* ìŠ¤í”Œë˜ì‹œ & ë¡œê·¸ì¸ */
        #splash-screen { position: fixed; inset: 0; background: white; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 9999; }
        .logo-circle { font-size: 4rem; margin-bottom: 20px; animation: bounce 2s infinite; }
        #splash-screen h1 { text-align: center; margin: 0; line-height: 1.2; color: var(--text-main); }

        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); backdrop-filter: blur(5px); display: flex; justify-content: center; align-items: center; z-index: 5000; }
        .modal-content { background: white; width: 85%; max-width: 360px; padding: 30px; border-radius: 24px; text-align: center; box-shadow: var(--shadow-md); }
        .grid-container { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px; }
        .login-btn { padding: 15px; border-radius: 16px; border: 1px solid #e2e8f0; background: white; font-weight: 500; cursor: pointer; color: var(--text-main); transition: all 0.2s; }
        .login-btn.taken { background: var(--primary-soft); color: var(--primary); border: none; font-weight: 700; }

        #app-container { display: flex; flex-direction: column; height: 100%; }
        .glass-header { padding: 15px 20px; background: rgba(255,255,255,0.9); backdrop-filter: blur(10px); position: sticky; top: 0; z-index: 10; border-bottom: 1px solid rgba(0,0,0,0.05); }
        .header-content { display: flex; justify-content: space-between; align-items: center; }
        .round-btn { width: 36px; height: 36px; border-radius: 50%; background: white; border: 1px solid #e2e8f0; margin-left: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; }

        #main-content { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 200px; }

        /* ì¹´ë“œ & ë¦¬ìŠ¤íŠ¸ */
        .verse-card { background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 20px; border-radius: 20px; margin-bottom: 25px; box-shadow: 0 10px 15px -3px rgba(118, 75, 162, 0.3); position: relative; }
        .verse-badge { font-size: 0.75rem; background: rgba(255,255,255,0.2); padding: 4px 10px; border-radius: 20px; display: inline-block; font-weight: 700; margin-bottom: 10px; }
        .verse-edit-btn { position: absolute; top: 20px; right: 20px; background: rgba(255,255,255,0.2); border: none; color: white; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        
        .input-pill { background: white; border-radius: var(--radius-pill); padding: 5px 5px 5px 20px; display: flex; align-items: center; box-shadow: var(--shadow-sm); margin-bottom: 20px; border: 1px solid #e2e8f0; }
        .input-pill input { flex: 1; border: none; font-size: 0.95rem; background: transparent; }
        .add-circle-btn { width: 42px; height: 42px; border-radius: 50%; background: var(--primary); color: white; border: none; font-size: 1.4rem; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .input-pill.small { padding: 4px 4px 4px 15px; margin-top: 10px; }
        .send-btn { background: var(--text-main); color: white; border: none; padding: 8px 16px; border-radius: 20px; font-size: 0.8rem; cursor: pointer; }

        .resolution-item { background: white; border-radius: 16px; padding: 15px; margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center; box-shadow: var(--shadow-sm); animation: slideUp 0.3s ease-out; }
        .res-left { flex: 1; }
        .res-text { font-weight: 600; font-size: 1rem; color: var(--text-main); margin-bottom: 8px; }
        .steps { display: flex; gap: 6px; flex-wrap: wrap; }
        .step-item { background: #f1f5f9; padding: 5px 10px; border-radius: 8px; font-size: 0.75rem; color: var(--text-light); cursor: pointer; transition: all 0.2s; }
        .step-item.done { background: var(--primary); color: white; }
        .del-icon-btn { background: none; border: none; color: #cbd5e1; font-size: 1rem; padding: 10px; cursor: pointer; }

        .chat-container { background: white; padding: 15px; border-radius: 20px; box-shadow: var(--shadow-sm); }
        #msg-list li { font-size: 0.85rem; margin-bottom: 8px; border-bottom: 1px solid #f1f5f9; padding-bottom: 5px; }
        #msg-list li b { color: var(--primary); margin-right: 5px; }

        /* ëŒ€ì‹œë³´ë“œ */
        .dashboard-row { display: flex; gap: 12px; margin-bottom: 12px; }
        .dash-card { flex: 1; background: white; border-radius: 20px; padding: 15px; box-shadow: var(--shadow-sm); display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; overflow: hidden; }
        
        .donut-container { position: relative; width: 80px; height: 80px; margin-bottom: 5px; }
        .donut-svg { transform: rotate(-90deg); width: 100%; height: 100%; }
        .donut-bg { fill: none; stroke: #f1f5f9; stroke-width: 8; }
        .donut-fill { fill: none; stroke: var(--primary); stroke-width: 8; stroke-dasharray: 251; stroke-dashoffset: 251; transition: stroke-dashoffset 1.5s ease-out; stroke-linecap: round; }
        .donut-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-weight: 800; font-size: 1.1rem; color: var(--text-main); }
        .dash-label { font-size: 0.8rem; color: var(--text-light); margin-top: 5px; font-weight: 600; }

        .streak-icon { font-size: 2.5rem; color: #cbd5e1; transition: all 0.5s; margin-bottom: 5px; }
        .streak-icon.active { color: #f97316; }
        .streak-icon.fire { color: #ef4444; filter: drop-shadow(0 0 5px rgba(239, 68, 68, 0.5)); }
        .streak-count { font-size: 1.4rem; font-weight: 800; color: var(--text-main); }

        .today-check-row { width: 100%; display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
        .check-pill { font-size: 0.8rem; background: #f1f5f9; padding: 4px 10px; border-radius: 12px; color: var(--text-light); }
        .check-pill.done { background: #dcfce7; color: #166534; font-weight: bold; }

        .bible-progress-container { width: 100%; margin-top: 10px; }
        .bible-book-name { font-size: 0.9rem; font-weight: bold; margin-bottom: 5px; display: block; text-align: left; }
        .progress-track { width: 100%; height: 8px; background: #f1f5f9; border-radius: 4px; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #6366f1, #a855f7); width: 0%; transition: width 1s ease-out; border-radius: 4px; }
        .bible-percent { font-size: 0.8rem; color: var(--text-light); float: right; margin-top: 3px; }

        .weekly-graph { display: flex; align-items: flex-end; justify-content: space-between; width: 100%; height: 60px; margin-top: 10px; gap: 4px; }
        .week-bar { flex: 1; background: #e2e8f0; border-radius: 4px; transition: height 1s ease-out; height: 0%; position: relative; }
        .week-bar.high { background: var(--primary); }
        .week-day-label { font-size: 0.6rem; color: #94a3b8; text-align: center; margin-top: 4px; }

        .period-card { background: linear-gradient(135deg, #4f46e5, #ec4899); color: white; padding: 20px; border-radius: 20px; margin-bottom: 25px; text-align: center; cursor: pointer; box-shadow: 0 10px 15px -3px rgba(79, 70, 229, 0.4); }
        .section-header { margin-bottom: 15px; margin-top: 30px; }
        .section-header:first-child { margin-top: 0; }
        .section-header .title { font-size: 1.1rem; font-weight: 800; color: var(--text-main); }

        .accordion-header { display: flex; justify-content: space-between; align-items: center; cursor: pointer; padding: 10px 0; }
        .accordion-icon { transition: transform 0.3s; color: var(--text-light); }
        .accordion-header.open .accordion-icon { transform: rotate(180deg); }
        .accordion-content { overflow: hidden; transition: max-height 0.3s ease-out; }

        .ranking-container { display: flex; gap: 15px; margin-bottom: 20px; }
        .ranking-box { flex: 1; background: white; border-radius: 16px; padding: 15px; box-shadow: var(--shadow-sm); }
        .ranking-title { font-size: 0.9rem; font-weight: 700; color: var(--text-main); margin-bottom: 10px; border-bottom: 1px solid #f1f5f9; padding-bottom: 8px; }
        .rank-row { display: flex; justify-content: space-between; font-size: 0.85rem; margin-bottom: 8px; }
        .rank-row .score { font-weight: 700; color: var(--primary); }

        .fame-row { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #f1f5f9; }
        .fame-winner { font-weight: bold; color: var(--text-main); }
        .crown-icon { color: var(--gold); margin-right: 5px; }

        /* ì„±ê²½ ê¸°ë³¸ */
        .bible-stat-row { display: flex; gap: 10px; margin-bottom: 20px; }
        .bible-stat-box { flex: 1; background: white; padding: 15px; border-radius: 16px; text-align: center; box-shadow: var(--shadow-sm); border: 1px solid #e2e8f0; }
        .bs-label { font-size: 0.75rem; color: var(--text-light); display: block; margin-bottom: 5px; }
        .bs-val { font-size: 1.2rem; font-weight: 800; color: var(--primary); }
        .bs-val.today { color: var(--accent); }

        .bible-card { display: flex; align-items: center; padding: 20px; border-radius: 20px; margin-bottom: 12px; cursor: pointer; background: white; box-shadow: var(--shadow-sm); border: 1px solid #e2e8f0; }
        .card-icon { font-size: 2rem; margin-right: 15px; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; background: #f1f5f9; }
        .grid-books { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
        .bible-btn { background: white; border: 1px solid #e2e8f0; border-radius: 10px; padding: 12px 0; text-align: center; font-size: 0.9rem; cursor: pointer; }
        .bible-btn.completed { background: #ecfccb; border-color: #84cc16; color: #3f6212; font-weight: 700; }
        .grid-chapters { display: grid; grid-template-columns: repeat(5, 1fr); gap: 6px; }
        .chapter-item { background: white; border: 1px solid #e2e8f0; border-radius: 8px; padding: 10px 0; text-align: center; cursor: pointer; font-size: 0.9rem; }
        .chapter-item.checked { background: var(--primary); color: white; border-color: var(--primary); font-weight: bold; }
        .finish-pill-btn { width: 100%; background: var(--text-main); color: white; border: none; padding: 12px; border-radius: 16px; font-size: 1rem; margin-bottom: 20px; cursor: pointer; }
        .finish-pill-btn.disabled { background: #e2e8f0; color: #94a3b8; cursor: not-allowed; }

        .bottom-nav { position: fixed; bottom: 0; width: 100%; height: 80px; background: rgba(255,255,255,0.95); display: flex; justify-content: space-around; padding-bottom: 20px; border-top: 1px solid rgba(0,0,0,0.05); z-index: 100; }
        .nav-item { background: none; border: none; color: #94a3b8; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; width: 100%; transition: color 0.2s; }
        .nav-item.active { color: var(--primary); }
    </style>
</head>
<body>

    <button onclick="hardReset()" style="position:fixed; top:0; left:0; z-index:99999; width:100%; height:50px; background:red; color:white; font-weight:bold; border:none; border-bottom:2px solid darkred;">
        ğŸš¨ ì—¬ê¸°ë¥¼ ëˆŒëŸ¬ì„œ ì—ëŸ¬ ê³ ì¹˜ê¸° (í„°ì¹˜) ğŸš¨
    </button>

    <div id="splash-screen">
        <div class="logo-circle">â›ªï¸</div>
        <h1>FAMILY<br>GOALS</h1>
    </div>

    <div id="login-modal" class="modal-overlay">
        <div class="modal-content">
            <h2 style="margin-top:0;">Welcome!</h2>
            <div id="login-grid" class="grid-container"></div>
        </div>
    </div>

    <div id="app-container" class="hidden">
        <header class="glass-header">
            <div class="header-content">
                <span style="font-size:1.2rem; font-weight:bold;">Hi, <b id="user-name">User</b></span>
                <div class="header-actions">
                    <button class="round-btn" onclick="alert('ì•ŒëŒ ê¸°ëŠ¥ì€ ëª¨ë°”ì¼ ë¸Œë¼ìš°ì € ì •ì±…ìƒ ì•±ì„ ì¼œë‘ì–´ì•¼ ìš¸ë¦½ë‹ˆë‹¤.')">ğŸ””</button>
                    <button class="round-btn" onclick="window.logoutAction()">ğŸšª</button>
                </div>
            </div>
        </header>

        <main id="main-content">
            <div class="verse-card">
                <div class="verse-badge">ì˜¤ëŠ˜ì˜ ë§ì”€</div>
                <button class="verse-edit-btn" onclick="window.editVerse()"><i class="fas fa-pen"></i></button>
                <p id="verse-text" style="font-weight:500;">Loading...</p>
                <p id="verse-ref" style="text-align:right; font-size:0.8rem; margin-top:5px; opacity:0.9;"></p>
            </div>

            <div id="page-resolution" class="page active">
                <div class="section-header"><span class="title">My Goals</span></div>
                <div class="input-pill">
                    <input type="text" id="input-resolution" placeholder="ëª©í‘œ ì…ë ¥ (ì˜ˆ: ìš´ë™í•˜ê¸°)">
                    <button onclick="window.addItem()" class="add-circle-btn">+</button>
                </div>
                <ul id="list-resolution" style="padding:0;"></ul>
                
                <div class="section-header"><span class="title">Family Chat</span></div>
                <div class="chat-container">
                    <ul id="msg-list" style="padding:0; margin:0; list-style:none;"></ul>
                    <div class="input-pill small" style="margin-top:10px; padding-left:15px;">
                        <input type="text" id="input-msg" placeholder="ë©”ì‹œì§€...">
                        <button onclick="window.sendMsg()" class="send-btn">ì „ì†¡</button>
                    </div>
                </div>
            </div>

            <div id="page-bible" class="page hidden">
                <div class="bible-stat-row">
                    <div class="bible-stat-box"><span class="bs-label">ì˜¤ëŠ˜ ì½ìŒ</span><span class="bs-val today" id="bible-today-count">0ì¥</span></div>
                    <div class="bible-stat-box"><span class="bs-label">ì˜¬í•´ ëˆ„ì </span><span class="bs-val" id="bible-year-count">0ì¥</span></div>
                </div>
                <div id="bible-main-view">
                    <div class="bible-card old" onclick="window.showBibleBooks('old')">
                        <div class="card-icon">ğŸ“œ</div><div><h3>êµ¬ì•½ (Old)</h3><p>39ê¶Œ</p></div>
                    </div>
                    <div class="bible-card new" onclick="window.showBibleBooks('new')">
                        <div class="card-icon">âœï¸</div><div><h3>ì‹ ì•½ (New)</h3><p>27ê¶Œ</p></div>
                    </div>
                </div>
                <div id="bible-books-view" class="hidden-view">
                    <button onclick="window.showBibleMain()" style="background:none; border:none; margin-bottom:10px;">â† ë’¤ë¡œ</button>
                    <h3 id="bible-testament-title" class="section-header title" style="margin-bottom:15px;"></h3>
                    <div id="bible-books-grid" class="grid-books"></div>
                </div>
                <div id="bible-chapters-view" class="hidden-view">
                    <button onclick="window.backToBooks()" style="background:none; border:none; margin-bottom:10px;">â† ëª©ë¡</button>
                    <div class="chapter-header-row">
                        <h3 id="bible-book-title" class="section-header title" style="margin:0;"></h3>
                        <div class="chapter-tools">
                            <button class="text-btn" onclick="window.controlAll(true)">ì „ì²´ì„ íƒ</button>
                            <button class="text-btn" onclick="window.controlAll(false)">í•´ì œ</button>
                        </div>
                    </div>
                    <button id="btn-finish-book" onclick="window.finishBookAndReset()" class="finish-pill-btn disabled">ì´ ì±… ì™„ë…í•˜ê¸° ğŸ‰</button>
                    <div id="bible-chapters-grid" class="grid-chapters"></div>
                </div>
            </div>

            <div id="page-stats" class="page hidden">
                <div class="period-card" onclick="window.manageSeason()">
                    <div style="font-size:0.8rem; opacity:0.9;">ğŸ† ê²°ë‹¨ì„œ ì‹œì¦Œ</div>
                    <div id="period-display" style="font-size:1.1rem; font-weight:700;">ì„¤ì • í•„ìš”</div>
                </div>

                <div class="section-header"><span class="title">ê°€ì¡± ë­í‚¹</span></div>
                <div class="ranking-container">
                    <div class="ranking-box"><div class="ranking-title">ğŸ“ ê²°ë‹¨ì„œ (ì‹œì¦Œ)</div><div id="rank-resolution"></div></div>
                    <div class="ranking-box"><div class="ranking-title">ğŸ“– ì„±ê²½ (ì´ë²ˆì£¼)</div><div id="rank-bible"></div></div>
                </div>

                <div class="section-header"><span class="title">ë‚˜ì˜ ëŒ€ì‹œë³´ë“œ</span></div>
                <div class="dashboard-row">
                    <div class="dash-card">
                        <div class="donut-container">
                            <svg class="donut-svg" viewBox="0 0 100 100"><circle class="donut-bg" cx="50" cy="50" r="40" /><circle class="donut-fill" id="donut-fill" cx="50" cy="50" r="40" /></svg>
                            <div class="donut-text" id="dash-rate">0%</div>
                        </div>
                        <div class="dash-label">ëª©í‘œ ë‹¬ì„±ë¥ </div>
                    </div>
                    <div class="dash-card">
                        <i class="fas fa-fire streak-icon" id="streak-icon"></i>
                        <div class="streak-count" id="dash-streak">0ì¼</div>
                        <div class="dash-label">ì—°ì† ì„±ê³µ</div>
                    </div>
                </div>

                <div class="dash-card" style="align-items:flex-start; margin-bottom:12px;">
                    <div style="width:100%; display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                        <span style="font-weight:bold;">ğŸ“… ì˜¤ëŠ˜ ëª©í‘œ</span><span class="check-pill" id="today-status">0/0 ì™„ë£Œ</span>
                    </div>
                    <div id="today-task-list" style="width:100%;"></div>
                </div>

                <div class="dash-card" style="align-items:flex-start; margin-bottom:12px;">
                    <div style="font-weight:bold; width:100%;">ğŸ“– í˜„ì¬ ì½ëŠ” ì¤‘</div>
                    <div class="bible-progress-container">
                        <span class="bible-book-name" id="current-book-name">ì—†ìŒ</span>
                        <div class="progress-track"><div class="progress-fill" id="bible-progress-bar"></div></div>
                        <span class="bible-percent" id="bible-book-percent">0%</span>
                    </div>
                </div>

                <div class="dash-card" style="align-items:flex-start; margin-bottom:12px;">
                    <div style="font-weight:bold; width:100%;">ğŸ¢ ì§€ë‚œ 7ì¼ í™œë™ëŸ‰</div>
                    <div class="weekly-graph" id="weekly-graph"></div>
                </div>

                <div class="accordion-header" onclick="window.toggleAccordion('acc-fame', this)">
                    <span class="title">ğŸ‘‘ ëª…ì˜ˆì˜ ì „ë‹¹</span><i class="fas fa-chevron-down accordion-icon"></i>
                </div>
                <div id="acc-fame" class="accordion-content hidden">
                    <div class="stat-card" id="hall-of-fame-list"></div>
                </div>
            </div>
        </main>

        <nav class="bottom-nav" style="position:fixed; bottom:0; width:100%; height:80px; background:rgba(255,255,255,0.95); display:flex; justify-content:space-around; padding-bottom:20px; border-top:1px solid #eee; z-index:100;">
            <button class="nav-item active" onclick="window.goTab('resolution', this)" style="background:none; border:none; width:100%;">
                <i class="fas fa-list-check" style="font-size:1.4rem; margin-bottom:4px;"></i><br><span style="font-size:0.7rem;">ëª©í‘œ</span>
            </button>
            <button class="nav-item" onclick="window.goTab('bible', this)" style="background:none; border:none; width:100%;">
                <i class="fas fa-book-open" style="font-size:1.4rem; margin-bottom:4px;"></i><br><span style="font-size:0.7rem;">ì„±ê²½</span>
            </button>
            <button class="nav-item" onclick="window.goTab('stats', this)" style="background:none; border:none; width:100%;">
                <i class="fas fa-chart-pie" style="font-size:1.4rem; margin-bottom:4px;"></i><br><span style="font-size:0.7rem;">ëŒ€ì‹œë³´ë“œ</span>
            </button>
        </nav>
    </div>

    <script>
    function hardReset() {
        localStorage.clear();
        alert("ê¹¨ë—í•˜ê²Œ ì²­ì†Œí–ˆìŠµë‹ˆë‹¤! ì•±ì„ ë‹¤ì‹œ ì¼­ë‹ˆë‹¤.");
        location.reload();
    }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, onSnapshot, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // â–¼â–¼â–¼ Config â–¼â–¼â–¼
        const firebaseConfig = {
            apiKey: "AIzaSyD0Vorv3SFatQuC7OCYHPA-Nok4DlqonrI",
            authDomain: "family-resolution.firebaseapp.com",
            projectId: "family-resolution",
            storageBucket: "family-resolution.firebasestorage.app",
            messagingSenderId: "711396068080",
            appId: "1:711396068080:web:861c41a8259f0b6dca9035",
            measurementId: "G-RH6E87B4H0"
        };

        const BIBLE_DATA = { "books": [ { "name": "ì°½ì„¸ê¸°", "chapters": 50, "testament": "old" }, { "name": "ì¶œì• êµ½ê¸°", "chapters": 40, "testament": "old" }, { "name": "ë ˆìœ„ê¸°", "chapters": 27, "testament": "old" }, { "name": "ë¯¼ìˆ˜ê¸°", "chapters": 36, "testament": "old" }, { "name": "ì‹ ëª…ê¸°", "chapters": 34, "testament": "old" }, { "name": "ì—¬í˜¸ìˆ˜ì•„", "chapters": 24, "testament": "old" }, { "name": "ì‚¬ì‚¬ê¸°", "chapters": 21, "testament": "old" }, { "name": "ë£»ê¸°", "chapters": 4, "testament": "old" }, { "name": "ì‚¬ë¬´ì—˜ìƒ", "chapters": 31, "testament": "old" }, { "name": "ì‚¬ë¬´ì—˜í•˜", "chapters": 24, "testament": "old" }, { "name": "ì—´ì™•ê¸°ìƒ", "chapters": 22, "testament": "old" }, { "name": "ì—´ì™•ê¸°í•˜", "chapters": 25, "testament": "old" }, { "name": "ì—­ëŒ€ìƒ", "chapters": 29, "testament": "old" }, { "name": "ì—­ëŒ€í•˜", "chapters": 36, "testament": "old" }, { "name": "ì—ìŠ¤ë¼", "chapters": 10, "testament": "old" }, { "name": "ëŠí—¤ë¯¸ì•¼", "chapters": 13, "testament": "old" }, { "name": "ì—ìŠ¤ë”", "chapters": 10, "testament": "old" }, { "name": "ìš¥ê¸°", "chapters": 42, "testament": "old" }, { "name": "ì‹œí¸", "chapters": 150, "testament": "old" }, { "name": "ì ì–¸", "chapters": 31, "testament": "old" }, { "name": "ì „ë„ì„œ", "chapters": 12, "testament": "old" }, { "name": "ì•„ê°€", "chapters": 8, "testament": "old" }, { "name": "ì´ì‚¬ì•¼", "chapters": 66, "testament": "old" }, { "name": "ì˜ˆë ˆë¯¸ì•¼", "chapters": 52, "testament": "old" }, { "name": "ì˜ˆë ˆë¯¸ì•¼ì• ê°€", "chapters": 5, "testament": "old" }, { "name": "ì—ìŠ¤ê²”", "chapters": 48, "testament": "old" }, { "name": "ë‹¤ë‹ˆì—˜", "chapters": 12, "testament": "old" }, { "name": "í˜¸ì„¸ì•„", "chapters": 14, "testament": "old" }, { "name": "ìš”ì—˜", "chapters": 3, "testament": "old" }, { "name": "ì•„ëª¨ìŠ¤", "chapters": 9, "testament": "old" }, { "name": "ì˜¤ë°”ëŒœ", "chapters": 1, "testament": "old" }, { "name": "ìš”ë‚˜", "chapters": 4, "testament": "old" }, { "name": "ë¯¸ê°€", "chapters": 7, "testament": "old" }, { "name": "ë‚˜í›”", "chapters": 3, "testament": "old" }, { "name": "í•˜ë°•êµ­", "chapters": 3, "testament": "old" }, { "name": "ìŠ¤ë°”ëƒ", "chapters": 3, "testament": "old" }, { "name": "í•™ê°œ", "chapters": 2, "testament": "old" }, { "name": "ìŠ¤ê°€ë´", "chapters": 14, "testament": "old" }, { "name": "ë§ë¼ê¸°", "chapters": 4, "testament": "old" }, { "name": "ë§ˆíƒœë³µìŒ", "chapters": 28, "testament": "new" }, { "name": "ë§ˆê°€ë³µìŒ", "chapters": 16, "testament": "new" }, { "name": "ëˆ„ê°€ë³µìŒ", "chapters": 24, "testament": "new" }, { "name": "ìš”í•œë³µìŒ", "chapters": 21, "testament": "new" }, { "name": "ì‚¬ë„í–‰ì „", "chapters": 28, "testament": "new" }, { "name": "ë¡œë§ˆì„œ", "chapters": 16, "testament": "new" }, { "name": "ê³ ë¦°ë„ì „ì„œ", "chapters": 16, "testament": "new" }, { "name": "ê³ ë¦°ë„í›„ì„œ", "chapters": 13, "testament": "new" }, { "name": "ê°ˆë¼ë””ì•„ì„œ", "chapters": 6, "testament": "new" }, { "name": "ì—ë² ì†Œì„œ", "chapters": 6, "testament": "new" }, { "name": "ë¹Œë¦½ë³´ì„œ", "chapters": 4, "testament": "new" }, { "name": "ê³¨ë¡œìƒˆì„œ", "chapters": 4, "testament": "new" }, { "name": "ë°ì‚´ë¡œë‹ˆê°€ì „ì„œ", "chapters": 5, "testament": "new" }, { "name": "ë°ì‚´ë¡œë‹ˆê°€í›„ì„œ", "chapters": 3, "testament": "new" }, { "name": "ë””ëª¨ë°ì „ì„œ", "chapters": 6, "testament": "new" }, { "name": "ë””ëª¨ë°í›„ì„œ", "chapters": 4, "testament": "new" }, { "name": "ë””ë„ì„œ", "chapters": 3, "testament": "new" }, { "name": "ë¹Œë ˆëª¬ì„œ", "chapters": 1, "testament": "new" }, { "name": "íˆë¸Œë¦¬ì„œ", "chapters": 13, "testament": "new" }, { "name": "ì•¼ê³ ë³´ì„œ", "chapters": 5, "testament": "new" }, { "name": "ë² ë“œë¡œì „ì„œ", "chapters": 5, "testament": "new" }, { "name": "ë² ë“œë¡œí›„ì„œ", "chapters": 3, "testament": "new" }, { "name": "ìš”í•œ1ì„œ", "chapters": 5, "testament": "new" }, { "name": "ìš”í•œ2ì„œ", "chapters": 1, "testament": "new" }, { "name": "ìš”í•œ3ì„œ", "chapters": 1, "testament": "new" }, { "name": "ìœ ë‹¤ì„œ", "chapters": 1, "testament": "new" }, { "name": "ìš”í•œê³„ì‹œë¡", "chapters": 22, "testament": "new" } ] };
        const USER_SLOTS = ["user_1", "user_2", "user_3", "user_4", "user_5", "user_6"];

        let app, db, docRef;
        let appData = {};
        let bibleState = { currentTestament: null, currentBook: null };
        let myName = localStorage.getItem('myId');

        async function startApp() {
            try {
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                docRef = doc(db, "appData", "FamilyGoals_Official_V1"); // â˜… ë°°í¬ìš© ìƒˆ DB

                onSnapshot(docRef, (snapshot) => {
                    document.getElementById('splash-screen').style.opacity = '0';
                    setTimeout(()=> document.getElementById('splash-screen').style.display='none', 500);

                    if(snapshot.exists()) {
                        const data = snapshot.data();
                        appData = data.appData ? data.appData : data;
                        if(!appData.auth) appData.auth = {};
                        if(!appData.period) {
                            const y = new Date().getFullYear();
                            appData.period = { start: `${y}-01-01`, end: `${y}-12-31` };
                        }
                        if(!appData.pastSeasons) appData.pastSeasons = [];
                        
                        USER_SLOTS.forEach(slot => {
                            if(!appData[slot]) appData[slot] = { resolution: [], bible: {}, history: {}, bibleRounds: {} };
                        });
                        checkLoginStatus();
                    } else {
                        initNewData();
                    }
                });
            } catch (e) { alert("Config ì˜¤ë¥˜"); }
        }

        // [New] ì˜¤ëŠ˜ì˜ ë§ì”€ ìˆ˜ì • ê¸°ëŠ¥
        window.editVerse = function() {
            const currentT = appData.verse ? appData.verse.t : "";
            const currentR = appData.verse ? appData.verse.r : "";
            const newT = prompt("ë§ì”€ ë‚´ìš©:", currentT);
            if(newT === null) return;
            const newR = prompt("ë§ì”€ ì¶œì²˜:", currentR);
            if(newR === null) return;
            
            if(!appData.verse) appData.verse = {};
            appData.verse.t = newT;
            appData.verse.r = newR;
            saveData();
        };

        function checkLoginStatus() {
            if(myName && appData.auth[myName]) {
                document.getElementById('login-modal').classList.add('hidden');
                document.getElementById('app-container').classList.remove('hidden');
                updateMainUI();
            } else {
                document.getElementById('app-container').classList.add('hidden');
                document.getElementById('login-modal').classList.remove('hidden');
                renderLoginButtons();
            }
        }

        function renderLoginButtons() {
            const grid = document.getElementById('login-grid');
            grid.innerHTML = "";
            USER_SLOTS.forEach((slot, idx) => {
                const btn = document.createElement('div');
                const user = appData.auth[slot];
                if(user) {
                    btn.className = "login-btn taken"; btn.innerHTML = `ğŸ”’ ${user.name}`;
                    btn.onclick = () => tryLogin(slot, user.pin);
                } else {
                    btn.className = "login-btn"; btn.innerHTML = `+ New`;
                    btn.onclick = () => tryRegister(slot);
                }
                grid.appendChild(btn);
            });
        }

        window.tryLogin = (s, p) => { if(prompt("PIN:")===p) { myName=s; localStorage.setItem('myId',s); checkLoginStatus(); } else alert("ë¹„ë°€ë²ˆí˜¸ ë¶ˆì¼ì¹˜"); };
        window.tryRegister = (s) => { const n=prompt("ì´ë¦„:"); if(!n)return; const p=prompt("PIN:"); if(!p)return; appData.auth[s]={name:n,pin:p}; if(!appData[s])appData[s]={resolution:[],bible:{},history:{}}; saveData().then(()=>{myName=s; localStorage.setItem('myId',s); checkLoginStatus();}); };
        window.logoutAction = () => { if(confirm("ë¡œê·¸ì•„ì›ƒ?")) { localStorage.removeItem('myId'); myName=null; checkLoginStatus(); } };

        function updateMainUI() {
            document.getElementById('user-name').innerText = appData.auth[myName].name;
            
            // [New] ë§ì”€ ì—…ë°ì´íŠ¸ (DBìš°ì„  -> ì—†ìœ¼ë©´ ê¸°ë³¸ê°’)
            if(appData.verse && appData.verse.t) {
                document.getElementById('verse-text').innerText = appData.verse.t;
                document.getElementById('verse-ref').innerText = appData.verse.r;
            } else {
                document.getElementById('verse-text').innerText = "í™˜ì˜í•©ë‹ˆë‹¤! âœï¸ë²„íŠ¼ì„ ëˆŒëŸ¬ ì˜¤ëŠ˜ì˜ ë§ì”€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.";
                document.getElementById('verse-ref').innerText = "Family Goals";
            }

            renderResolutionList(); renderMessages(); renderDashboard();
        }

        /* ëŒ€ì‹œë³´ë“œ ë° ê¸°íƒ€ ë¡œì§ (V3.0ê³¼ ë™ì¼) */
        function renderDashboard() {
            const period = appData.period || { start: "2024-01-01", end: "2024-12-31" };
            document.getElementById('period-display').innerText = `${period.start} ~ ${period.end}`;
            
            const myHistory = appData[myName].history || {};
            const myBible = appData[myName].bible || {};
            const today = new Date().toISOString().split('T')[0];

            const validDates = Object.keys(myHistory).filter(d => d >= period.start && d <= period.end);
            let totalDays = Math.max(1, Math.ceil((new Date() - new Date(period.start))/(1000*3600*24)));
            let successDays = 0; validDates.forEach(d => { if(myHistory[d] > 0) successDays++; });
            const rate = Math.min(100, Math.round((successDays / totalDays) * 100));
            
            document.getElementById('dash-rate').innerText = rate + "%";
            setTimeout(() => { document.getElementById('donut-fill').style.strokeDashoffset = 251 - (251 * rate / 100); }, 100);

            let streak = myHistory[today] ? 1 : 0;
            document.getElementById('dash-streak').innerText = streak + "ì¼";
            const fireIcon = document.getElementById('streak-icon');
            fireIcon.className = "fas fa-fire streak-icon"; 
            if(streak > 0) fireIcon.classList.add('active');

            const myGoals = appData[myName].resolution || [];
            const taskList = document.getElementById('today-task-list'); taskList.innerHTML = "";
            let todayTotal = 0, todayDone = 0;
            
            myGoals.forEach(g => {
                const isDoneToday = g.done.every(Boolean);
                todayTotal++; if(isDoneToday) todayDone++;
                const div = document.createElement('div');
                div.className = "today-check-row";
                div.innerHTML = `<span style="font-size:0.9rem;">${g.text}</span><span style="font-size:1.2rem; color:${isDoneToday?'var(--success)':'#ddd'}">${isDoneToday?'â—':'â—‹'}</span>`;
                taskList.appendChild(div);
            });
            const statusPill = document.getElementById('today-status');
            statusPill.innerText = `${todayDone}/${todayTotal} ì™„ë£Œ`;
            if(todayDone === todayTotal && todayTotal > 0) statusPill.classList.add('done'); else statusPill.classList.remove('done');

            let lastBook = "ì—†ìŒ", percent = 0;
            const readKeys = Object.keys(myBible).sort();
            if(readKeys.length > 0) {
                const lastKey = readKeys[readKeys.length-1];
                const [bName] = lastKey.split('-');
                lastBook = bName;
                const bookData = BIBLE_DATA.books.find(b=>b.name===bName);
                if(bookData) percent = Math.round((readKeys.filter(k=>k.startsWith(bName+'-')).length / bookData.chapters) * 100);
            }
            document.getElementById('current-book-name').innerText = lastBook;
            document.getElementById('bible-book-percent').innerText = percent + "%";
            setTimeout(() => { document.getElementById('bible-progress-bar').style.width = percent + "%"; }, 100);

            const weekGraph = document.getElementById('weekly-graph'); weekGraph.innerHTML = "";
            const dayNames = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '];
            for(let i=6; i>=0; i--) {
                const d = new Date(); d.setDate(d.getDate() - i);
                const dStr = d.toISOString().split('T')[0];
                const count = myHistory[dStr] || 0;
                const h = Math.min(100, count * 20); 
                weekGraph.innerHTML += `<div style="flex:1;display:flex;flex-direction:column;align-items:center;height:100%;"><div style="flex:1;display:flex;align-items:flex-end;width:100%;"><div class="week-bar ${h>0?'high':''}" style="width:60%;margin:0 auto;height:${h}%"></div></div><div class="week-day-label">${dayNames[d.getDay()]}</div></div>`;
            }

            renderRankings(period); renderHallOfFame();
        }

        function getWeeklyRange(){const n=new Date(),d=n.getDay(),diff=d===6?0:d+1;const s=new Date(n);s.setDate(n.getDate()-diff);const e=new Date(s);e.setDate(s.getDate()+6);return{start:s.toISOString().split('T')[0],end:e.toISOString().split('T')[0]};}
        function renderRankings(p){const u=USER_SLOTS.filter(x=>appData.auth&&appData.auth[x]);const r=document.getElementById('rank-resolution');r.innerHTML="";u.map(x=>{const h=appData[x].history||{},s=Object.keys(h).filter(d=>d>=p.start&&d<=p.end).reduce((a,b)=>a+h[b],0);return{name:appData.auth[x].name,val:s}}).sort((a,b)=>b.val-a.val).forEach((x,i)=>r.innerHTML+=`<div class="rank-row"><span>${i+1}.${x.name}</span><span class="score">${x.val}ì </span></div>`);const w=getWeeklyRange();document.querySelector('.ranking-box:nth-child(2) .ranking-title').innerText=`ğŸ“– ì„±ê²½ (ì´ë²ˆì£¼)`;const b=document.getElementById('rank-bible');b.innerHTML="";u.map(x=>{const bb=appData[x].bible||{},c=Object.values(bb).filter(d=>d>=w.start&&d<=w.end).length;return{name:appData.auth[x].name,val:c}}).sort((a,b)=>b.val-a.val).forEach((x,i)=>b.innerHTML+=`<div class="rank-row"><span>${i+1}.${x.name}</span><span class="score">${x.val}ì¥</span></div>`);}
        function renderHallOfFame(){const l=document.getElementById('hall-of-fame-list');l.innerHTML="";(appData.pastSeasons||[]).reverse().forEach(p=>l.innerHTML+=`<div class="fame-row"><div class="fame-season">${p.range}</div><div class="fame-winner">ğŸ‘‘ ${p.winner} (${p.score})</div></div>`);if(l.innerHTML==="")l.innerHTML="<div style='text-align:center;color:#94a3b8;font-size:0.8rem;'>ê¸°ë¡ ì—†ìŒ</div>";}
        window.toggleAccordion=function(id,h){const c=document.getElementById(id);c.classList.toggle('hidden');h.classList.toggle('open');};
        window.manageSeason=function(){const c=appData.period;if(!confirm(`ì‹œì¦Œ(${c.start}~${c.end}) ë§ˆê°?`)){const s=prompt("ì‹œì‘ì¼",c.start),e=prompt("ì¢…ë£Œì¼",c.end);if(s&&e){appData.period={start:s,end:e};saveData();}return;}const u=USER_SLOTS.filter(x=>appData.auth&&appData.auth[x]),r=u.map(x=>{const h=appData[x].history||{},s=Object.keys(h).filter(d=>d>=c.start&&d<=c.end).reduce((a,b)=>a+h[b],0);return{name:appData.auth[x].name,val:s}}).sort((a,b)=>b.val-a.val);if(!appData.pastSeasons)appData.pastSeasons=[];appData.pastSeasons.push({range:`${c.start}~${c.end}`,winner:r[0].name,score:r[0].val});const ns=prompt("ìƒˆì‹œì‘",new Date().toISOString().split('T')[0]),ne=prompt("ìƒˆì¢…ë£Œ","2024-12-31");appData.period={start:ns,end:ne};saveData().then(()=>alert("ì‹œì¦Œ ë§ˆê°ë¨!"));};

        window.addItem=()=>{const i=document.getElementById('input-resolution');if(!i.value.trim())return;if(!appData[myName].resolution)appData[myName].resolution=[];appData[myName].resolution.push({text:i.value.trim(),steps:["ì™„ë£Œ"],done:[false],counts:[0]});i.value="";saveData();};
        window.toggleStep=(i,s)=>{const item=appData[myName].resolution[i];item.done[s]=!item.done[s];if(!item.counts)item.counts=Array(item.steps.length).fill(0);if(item.done[s]){item.counts[s]++;if(window.confetti)confetti({particleCount:50,spread:60,origin:{y:0.6}});}else{item.counts[s]=Math.max(0,item.counts[s]-1);}const t=new Date().toISOString().split('T')[0];if(!appData[myName].history)appData[myName].history={};let d=0;appData[myName].resolution.forEach(r=>r.done.forEach(x=>{if(x)d++}));appData[myName].history[t]=d;saveData();};
        window.deleteItem=(i)=>{if(confirm("ì‚­ì œ?")){appData[myName].resolution.splice(i,1);saveData();}};
        window.editItem=(i)=>{const item=appData[myName].resolution[i],n=prompt("ìˆ˜ì •:",item.text);if(n){item.text=n;saveData();}};
        window.sendMsg=()=>{const i=document.getElementById('input-msg');if(!i.value.trim())return;if(!appData.messages)appData.messages=[];appData.messages.push({sender:appData.auth[myName].name,text:i.value.trim()});if(appData.messages.length>50)appData.messages.shift();i.value="";saveData();};
        function renderMessages(){const l=document.getElementById('msg-list');l.innerHTML="";[...(appData.messages||[])].reverse().forEach(m=>l.innerHTML+=`<li><b>${m.sender}:</b> ${m.text}</li>`);}
        
        window.showBibleBooks=(t)=>{bibleState.currentTestament=t;document.getElementById('bible-main-view').classList.add('hidden-view');document.getElementById('bible-books-view').classList.remove('hidden-view');const g=document.getElementById('bible-books-grid');g.innerHTML="";BIBLE_DATA.books.filter(b=>b.testament===t).forEach(b=>{const d=document.createElement('div');d.className="bible-btn";let c=0;const y=new Date().getFullYear().toString();for(let i=1;i<=b.chapters;i++){const k=`${b.name}-${i}`,dt=appData[myName].bible&&appData[myName].bible[k];if(dt&&dt.startsWith(y))c++;}if(c>=b.chapters)d.classList.add('completed');d.innerText=b.name;d.onclick=()=>showChapters(b);g.appendChild(d);});};
        function showChapters(b){bibleState.currentBook=b.name;document.getElementById('bible-books-view').classList.add('hidden-view');document.getElementById('bible-chapters-view').classList.remove('hidden-view');document.getElementById('bible-book-title').innerText=b.name;renderChaptersGrid();}
        function renderChaptersGrid(){const b=BIBLE_DATA.books.find(x=>x.name===bibleState.currentBook),g=document.getElementById('bible-chapters-grid'),y=new Date().getFullYear().toString();g.innerHTML="";let all=true;for(let i=1;i<=b.chapters;i++){const d=document.createElement('div');d.className="chapter-item";const k=`${b.name}-${i}`,dt=appData[myName].bible&&appData[myName].bible[k],r=dt&&dt.startsWith(y);if(r)d.classList.add('checked');else all=false;d.innerText=i;d.onclick=()=>window.toggleChapter(k,!r);g.appendChild(d);}const btn=document.getElementById('btn-finish-book');if(all){btn.classList.remove('disabled');btn.innerText="ì™„ë…í•˜ê¸° ğŸ‰";}else{btn.classList.add('disabled');btn.innerText="ëª¨ë‘ ì½ì–´ì•¼ ì™„ë… ê°€ëŠ¥";}}
        window.toggleChapter=(k,c)=>{if(!appData[myName].bible)appData[myName].bible={};if(c)appData[myName].bible[k]=new Date().toISOString().split('T')[0];else delete appData[myName].bible[k];saveData().then(()=>renderChaptersGrid());};
        window.controlAll=(on)=>{const b=BIBLE_DATA.books.find(x=>x.name===bibleState.currentBook),t=new Date().toISOString().split('T')[0];if(!appData[myName].bible)appData[myName].bible={};for(let i=1;i<=b.chapters;i++){const k=`${b.name}-${i}`;if(on)appData[myName].bible[k]=t;else delete appData[myName].bible[k];}saveData().then(()=>renderChaptersGrid());};
        window.finishBookAndReset=()=>{if(document.getElementById('btn-finish-book').classList.contains('disabled'))return;if(confirm("ì™„ë…?")){const b=bibleState.currentBook;if(!appData[myName].bibleRounds)appData[myName].bibleRounds={};appData[myName].bibleRounds[b]=(appData[myName].bibleRounds[b]||0)+1;window.controlAll(false);}};
        window.backToBooks=()=>{document.getElementById('bible-chapters-view').classList.add('hidden-view');document.getElementById('bible-books-view').classList.remove('hidden-view');};
        window.showBibleMain=()=>{document.getElementById('bible-books-view').classList.add('hidden-view');document.getElementById('bible-main-view').classList.remove('hidden-view');};
        window.goTab=(t,b)=>{document.querySelectorAll('.nav-item').forEach(e=>e.classList.remove('active'));b.classList.add('active');document.querySelectorAll('.page').forEach(e=>e.classList.add('hidden'));document.getElementById('page-'+t).classList.remove('hidden');if(t==='stats')renderDashboard();if(t==='bible')updateBibleStats();};
        async function saveData(){try{await setDoc(docRef,{appData:appData},{merge:true});updateMainUI();}catch(e){console.error(e);}}
        function initNewData(){const y=new Date().getFullYear();appData={auth:{},messages:[],period:{start:`${y}-01-01`,end:`${y}-12-31`}};saveData();}
        startApp();
    </script>
</body>
</html>
