<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>우리 가족 사랑방</title>

    <link rel="manifest" href="manifest.json">

    <meta name="theme-color" content="#2196F3" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#121212" media="(prefers-color-scheme: dark)">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="사랑방">

    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect width=%22100%22 height=%22100%22 rx=%2225%22 fill=%22%232196F3%22/><path d=%22M50 20 L80 45 L80 80 L20 80 L20 45 Z%22 fill=%22white%22/><text x=%2250%22 y=%2270%22 font-size=%2235%22 text-anchor=%22middle%22 dominant-baseline=%22middle%22>❤️</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect width=%22100%22 height=%22100%22 fill=%22%232196F3%22/><path d=%22M50 20 L80 45 L80 80 L20 80 L20 45 Z%22 fill=%22white%22/><text x=%2250%22 y=%2270%22 font-size=%2235%22 text-anchor=%22middle%22 dominant-baseline=%22middle%22>❤️</text></svg>">

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div id="loginScreen" class="login-screen">
    <div class="big-logo">
        <div class="heart-badge-big">❤️</div>
    </div>
    <h2 style="margin-bottom:10px;">우리 가족 사랑방</h2>
    <p style="margin-bottom:30px; font-size:13px; opacity:0.8;">함께 나누는 은혜와 사랑</p>
    <div class="member-grid" id="loginGrid"></div>
</div>

<div class="app-container">
    <aside class="sidebar-area">
        <header>
            <div class="top-row">
                <div style="display:flex; align-items:center; gap:12px;">
                    <div class="app-logo"><div class="heart-badge">❤️</div></div>
                    <div>
                        <span style="font-size:12px; opacity:0.7; font-weight:bold;">Love House</span>
                        <h1 class="user-name" id="userNameDisplay" style="font-size:18px;">사용자</h1>
                    </div>
                </div>
                <div class="header-btns">
                    <button class="icon-btn" onclick="window.toggleTheme()">🌙</button>
                    <button class="icon-btn" onclick="window.logoutAction()">🚪</button>
                </div>
            </div>
            <div class="verse-box" id="dailyVerseBox">
                <div class="verse-text" id="verseText">로딩 중...</div>
                <div class="verse-ref" id="verseRef"></div>
            </div>
            <div class="year-selector">
                <button class="year-btn" onclick="window.changeYear(-1)">◀</button>
                <span class="current-year" id="displayYear">2025</span>
                <button class="year-btn" onclick="window.changeYear(1)">▶</button>
            </div>
            <div style="text-align:center; font-size:11px; color:var(--sub-text); margin-bottom:10px;">▲ 성경 읽기 기록 연도</div>
        </header>
        <div class="tabs">
            <div class="tab active" data-target="resolution" onclick="window.goTab('resolution', this)">🔥 결단서</div>
            <div class="tab" data-target="bible" onclick="window.goTab('bible', this)" style="color:var(--bible)">📖 성경</div>
            <div class="tab" data-target="stats" onclick="window.goTab('stats', this)" style="color:var(--stats)">📊 통계</div>
            <div class="tab" data-target="cheers" onclick="window.goTab('cheers', this)" style="color:var(--chat)">🗣️ 소통</div>
            <div class="tab" data-target="settings" onclick="window.goTab('settings', this)">⚙️ 설정</div>
        </div>
    </aside>

    <main class="content-area">
        <div id="resolution" class="page active">
            <div class="input-group">
                <input type="text" id="input-resolution" placeholder="예: 말씀 1장 읽기 / 완료" onkeypress="if(event.key==='Enter') window.addItem('resolution')">
                <button class="add-btn" onclick="window.addItem('resolution')">+</button>
            </div>
            <ul id="list-resolution"></ul>
        </div>

        <div id="bible" class="page">
            <div class="bible-stats-box">
                <div class="stat-card">
                    <div style="font-size:12px;" id="weekLabel">이번 주 (토~금)</div>
                    <div class="stat-val" id="myWeeklyBible">0</div>
                </div>
                <div class="stat-card" style="background:#004d40;">
                    <div style="font-size:12px;" id="yearTotalLabel">2025년 누적</div>
                    <div class="stat-val" id="myYearlyBible">0</div>
                </div>
            </div>
            <div id="bible-main-view">
                <div class="testament-grid">
                    <button class="testament-btn" onclick="window.showBibleBooks('old')">구약 성경</button>
                    <button class="testament-btn" onclick="window.showBibleBooks('new')">신약 성경</button>
                </div>
            </div>
            <div id="bible-books-view" class="hidden-view">
                <div class="bible-nav-header">
                    <button class="bible-back-btn" onclick="window.showBibleMain()">◀ 뒤로</button>
                    <span style="font-size:18px; font-weight:bold; color:var(--bible);" id="bible-testament-title">구약</span>
                </div>
                <div class="book-grid" id="book-grid-container"></div>
            </div>
            <div id="bible-chapters-view" class="hidden-view">
                <div class="bible-nav-header">
                    <button class="bible-back-btn" onclick="window.backToBooks()">◀ 뒤로</button>
                    <span style="font-size:18px; font-weight:bold; color:var(--bible);" id="bible-book-title">창세기</span>
                </div>
                <div style="display:flex; gap:10px; margin-bottom:15px;">
                    <button style="flex:1; padding:10px; background:#00796b; color:white; border:none; border-radius:8px;" onclick="window.controlAllChapters(true)">전체 선택</button>
                    <button style="flex:1; padding:10px; background:#757575; color:white; border:none; border-radius:8px;" onclick="window.controlAllChapters(false)">전체 해제</button>
                </div>
                <div class="chapter-grid" id="chapter-grid-container"></div>
            </div>
        </div>

        <div id="stats" class="page">
            <div class="rank-grid">
                <div>
                    <div class="period-box">
                        <div style="font-weight:bold; color:var(--stats);">📅 결단서 시즌 기간 설정</div>
                        <div style="display:flex; gap:5px; justify-content:center; margin-top:10px;">
                            <input type="date" id="startDateInput" style="width:40%;"> ~ <input type="date" id="endDateInput" style="width:40%;">
                        </div>
                        <button class="save-period-btn" onclick="window.savePeriod()" style="margin-top:10px; padding:8px 20px; border:none; background:var(--stats); color:white; border-radius:10px;">적용</button>
                    </div>
                    <h4 style="color:var(--primary); margin-bottom:10px;">🔥 결단서 랭킹 <span style="font-size:11px; font-weight:normal; color:#666;" id="rankPeriodLabel"></span></h4>
                    <div id="resolutionRankList" style="margin-bottom:20px;"></div>
                </div>
                <div>
                    <h4 style="color:var(--bible); margin-bottom:10px;">📖 성경 다독왕 <span style="font-size:11px; font-weight:normal; color:#666;" id="bibleYearLabel"></span></h4>
                    <div id="bibleRankList"></div>
                </div>
            </div>
            <div class="analysis-box">
                <h4 style="margin:0 0 15px 0; color:#333;">📋 나의 습관 분석</h4>
                <div id="habitStatsList">
                    <div style="text-align:center; color:#999; font-size:12px;">아직 데이터가 충분하지 않습니다.</div>
                </div>
            </div>
        </div>

        <div id="cheers" class="page">
            <div style="text-align:center; color:var(--sub-text); font-size:13px; margin-bottom:10px;">가족들에게 응원의 한마디를 남겨주세요! 💖</div>
            <div class="chat-container" id="chatList"></div>
            <div class="input-group">
                <input type="text" id="input-msg" placeholder="메시지 입력..." onkeypress="if(event.key==='Enter') window.sendMsg()">
                <button class="add-btn" onclick="window.sendMsg()" style="background:var(--chat);">💌</button>
            </div>
        </div>
        
        <div id="settings" class="page">
             <div class="settings-card">
                 <h3 style="margin-top:0;">👤 프로필 수정</h3>
                 <div style="margin-bottom:15px;">
                     <label style="font-size:13px; color:var(--sub-text);">닉네임 변경</label>
                     <div style="display:flex; gap:5px; margin-top:5px;">
                         <input type="text" id="edit-nickname" placeholder="새 닉네임">
                         <button onclick="window.updateNickname()" style="width:60px; border-radius:10px; border:none; background:var(--primary); color:white;">변경</button>
                     </div>
                 </div>
                 <div style="margin-bottom:15px;">
                     <label style="font-size:13px; color:var(--sub-text);">비밀번호(PIN) 변경</label>
                     <div style="display:flex; gap:5px; margin-top:5px;">
                         <input type="password" id="edit-pin" placeholder="새 PIN (4자리)" maxlength="4">
                         <button onclick="window.updatePin()" style="width:60px; border-radius:10px; border:none; background:var(--edit); color:white;">변경</button>
                     </div>
                 </div>
             </div>
        </div>
    </main>
    
    <div id="serverStatus">연결 대기중...</div>
</div>

<script type="module" src="script.js"></script>

</body>
</html>
